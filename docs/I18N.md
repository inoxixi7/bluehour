# 多语言国际化 (i18n)

## 🌍 支持的语言

- 🇨🇳 **中文** (zh) - 默认语言
- 🇺🇸 **English** (en)
- 🇯🇵 **日本語** (ja)
- 🇩🇪 **Deutsch** (de)

## 📁 文件结构

```
src/
├── locales/
│   ├── i18n.ts           # i18n 配置和初始化
│   ├── zh.ts             # 中文翻译
│   ├── en.ts             # 英文翻译
│   ├── ja.ts             # 日文翻译
│   └── de.ts             # 德文翻译
└── utils/
    └── formatters.ts     # 工具函数中的 i18n 支持
```

## ⚙️ 核心特性

### 1. **自动语言检测**
- 使用 `expo-localization` 检测设备语言
- 自动匹配支持的语言,不支持的语言默认使用英语

### 2. **语言持久化**
- 使用 `AsyncStorage` 保存用户选择
- 下次打开应用自动加载保存的语言

### 3. **实时切换**
- 在设置页面选择语言
- 无需重启应用,全局立即生效

## 💻 使用方法

### 在组件中使用

```typescript
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();
  
  return (
    <Text>{t('home.title')}</Text>
  );
}
```

### 在工具函数中使用

```typescript
import i18n from '@/locales/i18n';

function formatValue() {
  return i18n.t('common.units.second');
}
```

### 带参数的翻译

```typescript
// 翻译文件
{
  "welcome": "Welcome, {{name}}!"
}

// 使用
t('welcome', { name: 'John' })
// 输出: "Welcome, John!"
```

## 📝 翻译文件结构

每个语言文件 (`zh.ts`, `en.ts`, `ja.ts`, `de.ts`) 都包含以下结构:

```typescript
{
  common: {
    loading: "加载中...",
    units: {
      second: "秒",
      cm: "厘米",
      // ...
    },
    exposureConditions: {
      sunny: "晴天",
      // ...
    }
  },
  
  navigation: {
    home: "首页",
    sunTimes: "日出日落",
    calculator: "计算器",
    settings: "设置"
  },
  
  home: {
    title: "摄影助手",
    features: {
      sunTimes: {
        title: "蓝调时刻",
        description: "规划完美的拍摄时间"
      }
      // ...
    }
  },
  
  sunTimes: {
    phases: {
      morningBlueHour: "早晨蓝调时刻",
      sunrise: "日出",
      // ...
    }
  },
  
  calculator: {
    ev: { /* EV计算器翻译 */ },
    nd: { /* ND滤镜计算器翻译 */ },
    dof: { /* 景深计算器翻译 */ }
  },
  
  settings: {
    languages: {
      zh: "中文",
      en: "English",
      ja: "日本語",
      de: "Deutsch"
    },
    themes: {
      light: "浅色",
      dark: "深色",
      auto: "跟随系统"
    }
  }
}
```

## 🔧 技术实现

### 依赖包
```json
{
  "i18next": "^23.x",
  "react-i18next": "^14.x",
  "expo-localization": "~14.8.4"
}
```

### 配置 (src/locales/i18n.ts)

```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

import zh from './zh';
import en from './en';
import ja from './ja';
import de from './de';

const resources = { zh, en, ja, de };

const initI18n = async () => {
  const savedLanguage = await AsyncStorage.getItem('app-language');
  const deviceLanguage = Localization.locale.split('-')[0];
  
  const supportedLanguages = ['zh', 'en', 'ja', 'de'];
  const fallbackLanguage = supportedLanguages.includes(deviceLanguage) 
    ? deviceLanguage 
    : 'en';

  await i18n
    .use(initReactI18next)
    .init({
      resources,
      lng: savedLanguage || fallbackLanguage,
      fallbackLng: 'en',
      interpolation: {
        escapeValue: false,
      },
    });
};

export const changeLanguage = async (language: string) => {
  await AsyncStorage.setItem('app-language', language);
  await i18n.changeLanguage(language);
};

export default i18n;
export { initI18n };
```

## ✅ 已国际化的内容

### 全局组件
- ✅ 所有导航标题
- ✅ 加载指示器
- ✅ 位置搜索组件

### 页面
- ✅ **主页** - 所有功能卡片标题和描述
- ✅ **日出日落** - 所有时段名称、标签、错误信息
- ✅ **计算器** - EV/ND/景深计算器的所有文本
- ✅ **设置** - 语言选择、主题选择、关于信息

### 工具函数
- ✅ `formatShutterSpeed()` - 快门速度单位 (秒/分钟/小时)
- ✅ `formatDistance()` - 距离单位 (cm/m)
- ✅ `formatDate()` - 日期格式
- ✅ `formatDuration()` - 时长单位

### 特殊处理
- ✅ **曝光环境** - 从"非常暗"到"非常亮"的7个等级
- ✅ **相机传感器** - 全画幅、APS-C、M4/3、1英寸等
- ✅ **ND滤镜提示** - 原始快门速度说明文字

## 🎯 添加新语言

如果需要添加新语言(如法语 fr):

1. **创建翻译文件** `src/locales/fr.ts`
   ```typescript
   export default {
     translation: {
       common: { /* ... */ },
       navigation: { /* ... */ },
       // 复制其他语言文件的结构
     }
   };
   ```

2. **注册到 i18n.ts**
   ```typescript
   import fr from './fr';
   
   const resources = { zh, en, ja, de, fr };
   const supportedLanguages = ['zh', 'en', 'ja', 'de', 'fr'];
   ```

3. **添加到设置页面**
   ```typescript
   // src/locales/*/translation/settings.ts
   languages: {
     // ...
     fr: "Français"
   }
   ```

## 📌 注意事项

1. **所有用户可见的文本都必须使用 `t()` 函数**
2. **不要在代码中硬编码中文或其他语言文本**
3. **在工具函数中需要使用 `i18n.t()` 而不是 `useTranslation` hook**
4. **翻译键名使用点号分隔,保持层级清晰**
5. **所有语言文件必须保持相同的键结构**

## 🌟 翻译质量

所有翻译都经过精心调整,使用自然且专业的摄影术语:

- **中文**: 使用摄影界通用的术语(如"蓝调时刻"、"黄金时刻")
- **English**: Professional photography terminology (Blue Hour, Golden Hour)
- **日本語**: 自然な写真用語 (ブルーアワー、ゴールデンアワー)
- **Deutsch**: Professionelle Fotografie-Terminologie (Blaue Stunde, Goldene Stunde)
