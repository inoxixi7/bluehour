# 多语言地点搜索与时区支持功能

## 功能概述
使用 OpenStreetMap 的 Nominatim API 实现的多语言地点搜索功能,支持用户以任何语言输入地点名称进行搜索。同时集成时区支持,自动将太阳时间转换为选定地点的当地时间。

## 支持的语言
- 🇨🇳 中文（简体/繁体）
- 🇺🇸 英文
- 🇯🇵 日文
- 🇩🇪 德文
- 以及其他 Nominatim 支持的语言

## 搜索示例

### 同一地点的不同语言输入
以下输入都能找到北京:
- 中文: `北京`, `北京市`
- 英文: `Beijing`, `Peking`
- 日文: `北京`, `ペキン`
- 德文: `Peking`

### 搜索类型
支持搜索多种地点类型:
- 🏙️ 城市 (city, town)
- 🏘️ 村庄 (village)
- 🌍 国家 (country)
- 📍 州/省 (state)
- 📌 其他地标

## 技术实现

### API 服务
- **文件**: `src/api/geocodingService.ts`
- **功能**:
  - `searchLocation()`: 地点搜索（支持多语言输入）
  - `reverseGeocode()`: 反向地理编码（坐标转地址）

### 搜索组件
- **文件**: `src/components/LocationSearch/LocationSearch.tsx`
- **特性**:
  - 实时搜索（500ms 防抖）
  - 最多显示 8 个结果
  - 自动关闭键盘
  - 显示地点类型图标
  - 展示完整地址信息

### UI 更新
- **文件**: `src/screens/SunTimesScreen/SunTimesScreen.tsx`
- **改进**:
  - 移除了"获取当前位置"和"使用测试位置"按钮
  - 添加了搜索框，支持多语言地点搜索
  - 自动在进入页面时获取当前位置
  - 显示选中位置的完整地址和坐标
  - 提供"刷新当前位置"按钮

### 权限管理
- **文件**: `App.tsx`
- **改进**: 在 App 启动时自动请求位置权限

## 使用方法

1. **搜索地点**
   - 在搜索框中输入地点名称（任何语言）
   - 等待搜索结果出现
   - 点击选择想要的地点

2. **使用当前位置**
   - 页面加载时会自动获取当前位置
   - 或点击"刷新当前位置"按钮

3. **查看位置信息**
   - 选中的位置会显示完整地址
   - 坐标精确到小数点后4位

## API 限制
- Nominatim API 要求设置 User-Agent
- 建议不要频繁请求（已实现防抖）
- 免费使用有请求频率限制

## 时区支持

### 自动时区检测
- **API**: TimeAPI.io (https://timeapi.io)
- **功能**: 根据经纬度自动获取时区信息
- **返回数据**:
  - 时区标识符 (如 "Asia/Shanghai", "America/New_York")
  - UTC 偏移量（分钟）

### 时间转换
- **文件**: `src/utils/timezone.ts`
- **功能**:
  - `convertToTimezone()`: 将 UTC 时间转换为指定时区时间
  - `formatTimezoneOffset()`: 格式化时区偏移量显示 (如 "UTC+8")
  - `convertSunTimesToTimezone()`: 批量转换所有太阳时间到指定时区
  - `getTimezoneDisplayName()`: 获取时区友好显示名称

### 时区显示
搜索或选择地点后会显示:
- 完整地址
- 坐标（精确到小数点后4位）
- 时区信息（如 "Asia/Shanghai (UTC+8)"）

### 实际应用
1. **蓝调时刻页面**: 搜索任何地点，所有时间自动转换为该地点的当地时间
2. **首页时间卡片**: 显示当前位置对应时区的摄影时段信息

### 示例
- 搜索"东京": 显示时间为 JST (UTC+9)
- 搜索"纽约": 显示时间为 EST/EDT (UTC-5/-4)
- 搜索"伦敦": 显示时间为 GMT/BST (UTC+0/+1)

## 未来扩展
准备支持的语言:
- 🇰🇷 韩文
- 🇫🇷 法文
- 🇪🇸 西班牙文
- 🇮🇹 意大利文
- 🇷🇺 俄文

只需在 API 请求中的 `accept-language` 参数添加对应的语言代码即可。

## 技术细节

### 时区转换算法
1. 从 sunrise-sunset.org API 获取 UTC 时间
2. 通过 TimeAPI.io 获取目标地点的时区偏移量
3. 使用时区偏移量转换所有时间到当地时间
4. 在 UI 中显示转换后的本地时间

### API 使用限制
- **Nominatim**: 免费使用，建议添加防抖避免频繁请求
- **TimeAPI.io**: 免费使用，无需 API key
